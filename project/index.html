<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USA Votes</title>
  <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></scipt>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="https://d3js.org/d3-queue.v2.min.js"></script>
  <style>
  .states {
    fill: none;
    stroke: #fff;
    stroke-linejoin:round;
  }
  </style>
</head>
<body>
  <!-- Page elements and content will go here. -->
  <script>
  //map width and heights
  var width = 700;
  var height = 580;

  var color = d3.scaleThreshold()
      .domain([0.02, 0.04, 0.06, 0.08, 0.10])
      .range(["#f2f0f7", "#dadaeb", "#bcbddc", "#9e9ac8", "#756bb1", "#54278f"])
  //define the projection
  //Using albers projection of the USA
  var projection = d3.geoAlbers()
      .scale(1000)
      .translate([width / 2,height / 2]);
  //Create GeoPath function that uses built-in D3 functionality to turn
  //lat/lon coords into screen coords
  var path = d3.geoPath() //create path generator function
      .projection(projection); //add our define projection
  //Create svg
  var svg = d3.select( "body" ).append( "svg" )
      .attr( "width", width )
      .attr( "height", height );

  //Queue up datasets using d3 queue
  d3.queue()
    .defer(d3.json, "states.json") //Load US states
    .defer(d3.csv, "Book1.csv")
    .await(ready); //Run 'ready' when JSONs are loaded
function ready(error, us, Trump){
  if (error) throw error;

  var rateById = {};
    trump.forEach(function(d) {rateById[d.id] = +d.rate;});
  svg.append("g")
      .attr("class", "states")
      .selectAll("path")
      .data(topojson.feature(us, us.objects.counties).features)
      .enter().append("path")
      .attr("d", path)
      .style("fill", function(d) {return color(rateById[d.id]);});
  svg.append("path")
      .datum(topojson.mesh(us, us.objects.states, function(a,b) { return a.id !== b.id}))
      .attr("class", "states")
      .attr("d", path);
}
  </script>
</body>
</html>
<!-- https://stackoverflow.com/questions/21381097/d3-is-not-defined-referenceerror
http://duspviz.mit.edu/d3-workshop/mapping-data-with-d3/
https://github.com/mjfoster83/d3-workshop/tree/master/d3_part4_mappingData
